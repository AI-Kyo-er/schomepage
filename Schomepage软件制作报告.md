# Schomepage主页生成系统 - 软件制作报告

**项目名称**: Schomepage主页生成系统  
**开发团队**: 潘旭, 韦先轶, 刘远巍
**开发周期**: 2025年4月初 - 2025年6月初  
**报告版本**: v1.0 (2025年6月)

---

## 1. 引言

### 1.1 项目背景
随着互联网内容的日益丰富，用户对于个性化、交互式主页内容的需求不断增长。传统主页制作方式往往需要较高的技术门槛，或依赖复杂的内容管理系统。**在Web 2.0及后续发展浪潮中，用户生成内容（UGC）的趋势日益显著，对低代码/无代码（Low-Code/No-Code）的创作工具需求旺盛，使得不具备专业编程背景的个体也能轻松构建和分享个性化数字空间。同时，用户对内容的交互性、动态性以及创作过程中的数据隐私和安全保障也提出了更高要求。尤其在校园等环境中，针对学生、教师、访客等不同群体，动态推送其最关心的信息（如课程通知、科研动态、校园开放日活动）显得尤为重要，这能显著提升信息传递的效率和用户体验。**为了解决这一痛点，我们团队——由潘旭、韦先轶、刘远巍三名大三学生组成——在2025年4月初至6月初期间，致力于开发一款名为"Schomepage主页生成系统"的HTML图文文章编辑器工作站。

### 1.2 项目目标
本项目旨在为用户提供一个易于上手、功能强大的在线编辑环境，使得非专业用户也能轻松创建、管理和发布具有丰富交互功能的个性化主页和图文文章。系统核心目标包括：
*   **易用性**: 提供类似Office Word的半图形化操作界面，降低用户学习成本。**例如，用户在 `main.html` 中看到的画布、工具栏和属性面板，其交互逻辑由相应的JavaScript模块驱动，旨在模拟用户熟悉的操作习惯。**
*   **功能性**: 集成用户管理、内容编辑、素材管理、动态内容展示、访客管理等多种实用功能。**例如，`server.py` 中的 `/api/articles` 路由负责文章的增删改查，而前端的编辑器则调用此API完成内容的持久化。**
*   **安全性**: 采用多层安全防护体系，保障用户数据和系统访问安全。**具体体现在前端 `crypto.js` 的密码加密逻辑和后端 `server.py` 对加密密码的比对验证，以及对API访问的会话检查。**
*   **可扩展性**: 设计模块化的系统架构，为未来功能升级奠定基础。**前端JavaScript被拆分为 `auth.js`, `register.js`, `config.js` 等多个模块，后端API也遵循功能进行划分，便于独立维护和扩展。**

### 1.3 报告目的
本报告旨在详细记录Schomepage主页生成系统的开发历程，系统阐述在项目过程中如何运用软件工程的理论和方法进行需求分析、系统设计、实现、测试与部署。同时，本报告也将深入剖析软件的各项特性与功能，并对项目管理和团队协作进行总结，为后续的软件维护、升级以及类似项目的开发提供参考和借鉴。

---

## 2. 项目概述

### 2.1 软件愿景与核心价值
Schomepage主页生成系统的愿景是成为一款轻量级、高效率的个人及小型团队内容创作与发布平台。其核心价值在于：
*   **赋能创作**: 让不具备专业编程技能的用户也能自由表达和设计在线内容。
*   **智能交互**: 通过动态隐藏、文章链接等功能，提升内容的互动性和用户体验。
*   **安全可靠**: 提供端到端的加密方案和稳健的访问控制，保护用户创作成果。
*   **一站式解决方案**: 从内容编辑、素材管理到访客互动，提供完整的工作流程。

### 2.2 目标用户
本系统的目标用户群体广泛，主要包括：
*   **教育工作者**: 创建课程主页、教学资源、学术推广页面。**例如，教师可以利用可视化编辑器混合图文内容，通过"文章链接"功能链接到外部教学资源或本系统内的其他相关页面（如 `server.py` 中 `/link/<username>/<filename>` 路由所支持的），使用"动态隐藏模块"（前端通过 `data-hide-rule` 和 `data-hide-users` 属性实现）为不同班级或用户组（如助教、学生）精确推送定制化的通知、作业、或参考资料，例如，将特定专业的研讨会信息仅对该专业学生显示。并通过"访客通道"（由 `server.py` 的别名路由处理）为学生提供易于访问的课程入口。结合"访客统计"数据（记录在各文章目录下的 `accrecord.csv`），教师还能分析不同学生群体对哪些教学内容的关注度更高，从而优化教学信息发布策略，使内容推送更为精准有效。**
*   **学生**: 制作个人主页、项目展示、社团活动宣传。**他们可以利用丰富的素材库（图片存储于 `../workplace/<username>/pics/`，由 `server.py` 管理）和便捷的编辑工具快速搭建展示页面。**
*   **个人博主/创作者**: 发布图文博客、作品集、兴趣分享。**编辑器支持的撤销/重做功能（基于MutationObserver）和文章自动保存（待实现，目前为手动保存）能提升创作体验。**
*   **小型企业/团队**: 搭建简单的产品介绍页、团队主页、活动通知。**"访客统计"功能（数据记录在各文章目录下的 `accrecord.csv`）可以帮助他们了解内容的受欢迎程度。**

**2.3 领域背景与难题**

在Schomepage的开发过程中，我们不仅关注软件功能的实现，也深入思考了其所处的领域背景及面临的挑战：

*   **低代码/无代码创作的普及与深化**：虽然市面上已有不少主页构建工具，但如何在简化操作的同时，提供足够的灵活性和强大的功能，以满足用户日益增长的个性化需求，是一个持续的挑战。Schomepage试图通过类似Word的半图形化界面和模块化组件来平衡易用性与功能性。

*   **用户数据安全与隐私保护的复杂性**：在用户数据日益重要的今天，确保用户创作内容及个人信息的安全是系统的生命线。
    *   **密码安全**：传统的明文存储或简单哈希已无法满足安全需求。我们面临的难题是如何在资源有限（例如，不引入大型安全框架或数据库级的加密特性）的情况下，实现可靠的密码保护。这促使我们研究并实现了基于离散对数的端到端加密方案（详见 `crypto.js`, `crypto_utils.py` 和 `系统安全性说明.md`）。选择自定义实现，一方面是深入学习加密原理的尝试，另一方面也旨在提供一个轻量级、自包含的安全模块，避免对外部重度依赖。然而，自定义加密亦带来了标准性、可审计性和密钥管理等方面的挑战。
    *   **访问控制**：如何精细化地控制谁可以访问哪些内容，特别是在支持"访客通道"和"动态隐藏模块"等功能时，需要周密的逻辑设计来防止越权访问和信息泄露。

*   **动态与个性化内容的实现难度**：
    *   **内容动态显隐**：为了实现如"动态隐藏模块"功能（基于 `data-hide-rule` 和用户身份动态调整元素可见性），需要在前端JavaScript逻辑中精确解析规则、高效操作DOM，并确保与后端用户身份验证机制的正确联动。这涉及到前端状态管理、规则引擎设计等方面的技术难题。
    *   **个性化模板与主题**：虽然系统提供了基础模板，但如何让用户更自由地定制页面布局、风格，甚至引入自定义CSS/JS，同时又不破坏系统的整体性和安全性，是提升用户体验的关键，也是一个设计上的挑战。

*   **轻量级部署与跨平台兼容性**：目标用户可能不具备专业IT背景，因此提供一个易于安装和启动的软件包至关重要。`setup.py` 通过PyInstaller打包成Windows可执行文件是一个解决方案，但未来若需支持macOS或Linux，则需要考虑跨平台打包策略和依赖管理。此外，前端代码对不同浏览器的兼容性也是需要持续关注和测试的方面。

*   **内容版本管理与协作的缺失**：当前版本主要面向单用户创作。在教育或小型团队场景下，多人协作编辑、内容版本回溯等高级功能的需求是存在的，但这会引入数据一致性、并发控制等更复杂的领域难题。

理解并尝试应对这些领域背景下的难题，是Schomepage项目不断迭代和完善的驱动力。

---

## 3. 软件工程方法应用

在Schomepage的整个开发生命周期中，我们严格遵循软件工程的原则和方法，确保项目按计划、高质量完成。

**3.0 项目计划**
在项目启动初期（2025年4月初），团队首先进行了初步的项目规划：
*   **目标设定**：明确了项目的核心功能——开发一个HTML图文文章编辑器工作站，并设定了关键特性如用户管理、可视化编辑、动态内容、安全加密等。
*   **时间规划**：整体开发周期定为两个月（4月初至6月初）。初步划分为需求分析与设计（2周）、核心功能开发（4周）、测试与优化（1周）、文档与打包（1周）等阶段。
*   **任务分解与分配**：基于团队成员的技术栈（潘旭后端，韦先轶编辑器前端，刘远巍UI/UX与流程前端），对主要模块进行了初步的责任分配。
*   **资源评估**：主要依赖团队成员的课余时间和现有知识储备，以及开源工具和库（Python Flask, 原生JS, PyInstaller等）。
*   **风险预估**：预见了可能的技术难点（如前端复杂交互、安全性实现）、协作沟通成本和时间紧张等风险，并计划通过定期会议和代码评审来缓解。
虽然计划在后续执行中会动态调整，但这份初步规划为项目的顺利启动和有序推进奠定了基础。

### 3.1 需求分析
在项目初期（2025年4月初），团队通过以下方式进行了需求分析：
*   **头脑风暴与用户故事**: 设想不同用户场景（如学生制作课程主页、教师发布通知、博主撰写文章），提炼核心需求。例如，"教师希望发布一个课程通知，只对已选课学生可见"，这个用户故事直接催生了"动态隐藏模块"中"只给谁看"的功能需求。**除了用户故事，团队也绘制了简要的用例图来梳理不同角色（管理员、注册用户、访客）与系统的主要交互功能，例如"用户注册"、"用户登录"、"编辑文章"、"发布文章"、"别名访问"等用例，这有助于从整体上把握系统边界和核心服务。**
*   **功能列表梳理**: 基于用户故事 **和用例**，初步定义了系统的关键功能模块，如用户认证、文章编辑、素材管理、访客通道等。这些模块的需求进一步细化为 `server.py` 中具体的API接口定义（如 `/login`, `/register`, `/api/upload_image` 等）和前端 `main.html` 及其关联JS文件中的交互逻辑。
*   **现有系统参考**: 分析了市面上部分HTML编辑器和轻量级CMS的优缺点，明确了本项目的差异化和创新点。
*   **迭代式需求确认**: 随着开发的深入，根据实际遇到的问题和新的想法，对需求进行动态调整和完善。例如，最初的"访客通道"可能仅设计为简单的URL重定向，后续根据用户反馈或进一步分析，增加了别名管理、访客类型统计等功能，这些都记录在 `版本更新与修复说明.md` 的迭代历史中。`registration_checklist.json` 文件的引入也是一个例子，它将用户注册成功后的后台自动化任务（如创建专属文件夹）明确化、流程化，这本身就是对"用户成功注册后应能立即开始使用"这一隐性需求的细化和保障。**这种迭代确认也体现在对 `config.js` 的引入，最初可能分散在各JS文件中的配置项，在意识到维护困难后，被统一提取和管理，这也是对可维护性需求的响应。**

**关键功能需求点（部分摘录自项目文档）：**
*   用户系统：登录、注册（邮箱验证）、密码修改（离散对数加密）、会话管理。 (参考 `系统安全性说明.md`, `版本更新与修复说明.md`) **这些需求直接对应 `server.py` 中的 `/login`, `/register`, `/send_code`, `/verify_code`, `/update_password` 等API接口，以及前端 `auth.js` 和 `register.js` 中的处理逻辑。**
*   编辑器：可视化编辑、文本/图片/图案插入、格式化、属性面板、撤销/重做。 (参考 `工作页面使用介绍.md`) **这些主要由 `main.html` 页面的DOM结构和大量原生JavaScript代码实现，包括对用户操作的事件监听、DOM元素的动态创建与修改等。**
*   内容发布：文章链接、访客通道（别名访问）、动态隐藏模块。 (参考 `代码更新与修复说明.md`, `工作页面使用介绍.md`) **"文章链接"由后端的 `/link/...` 路由和前端生成特定格式URL的逻辑支持；"访客通道"依赖于后端的别名解析路由和前端的别名管理界面；"动态隐藏模块"则主要依靠前端JavaScript根据URL参数 (`&user=xxx`) 和元素自定义属性 (`data-hide-rule`) 进行渲染控制。**

### 3.2 系统设计

#### 3.2.1 技术选型
考虑到开发效率、部署便捷性和团队成员的技术栈，我们选择了以下技术：
*   **后端**: Python Flask (轻量级Web框架，快速开发API)。**Flask的微框架特性使得启动和运行非常迅速，适合小型项目和快速原型开发。其自带的Werkzeug WSGI工具集和Jinja2模板引擎也为开发提供了便利，尽管本项目前端主要依赖原生JS渲染。**
*   **前端**: 原生JavaScript, HTML5, CSS3 (灵活控制DOM，无需引入重型框架)。**选择原生JavaScript主要是为了最大限度地控制DOM结构和行为，实现定制化的编辑器交互效果，同时也为了锻炼团队成员的基础前端能力。虽然这在项目后期可能带来代码量较大、缺乏标准化组件等问题，但在项目初期，它提供了快速启动和高度灵活性。**
*   **数据存储**: CSV文件 (结构简单，易于读写，适合小型应用的用户和配置数据)。**选择CSV文件作为数据存储方案，主要基于其简易性、可读性以及无需额外数据库服务依赖的考虑，这对于一个目标是易于本地部署的桌面式Web应用是合适的。例如 `users.csv` 直接存储用户信息，`redirect.csv`（后演变为访客通道管理功能）存储URL映射。我们意识到CSV在并发写入、数据一致性校验和复杂查询方面存在局限，但在当前系统规模和单用户主要操作的场景下，其便捷性占据了主导。**
*   **加密库**: 自定义离散对数加密实现 (前端`crypto.js`, 后端`crypto_utils.py`)。**如2.3节所述，自定义加密是为了深入学习和实现一个轻量级、前后端一致的加密方案。**

#### 3.2.2 架构设计
系统采用前后端分离的架构：
*   **前端 (`main.html`, `auth.js`, `register.js`, `config.js`等)**: 负责用户界面展示、用户交互逻辑、数据可视化、以及部分客户端运算（如密码加密）。前端通过API与后端进行数据交换。 **这种分离使得前端可以专注于用户体验和界面呈现，后端则聚焦于业务逻辑和数据处理。例如，`main.html` 作为单页应用（SPA）的载体，其内容动态由JavaScript（如编辑器逻辑、文章加载逻辑）根据用户操作和API返回数据来渲染和更新。**
*   **后端 (`server.py`, `crypto_utils.py`)**: 提供RESTful API接口，处理用户认证、数据存取、文件管理、邮件发送等业务逻辑。 **`server.py` 中的Flask路由（如 `/api/articles`, `/api/user_info`, `/api/settings`）定义了清晰的服务契约，供前端调用。**

**模块化设计**:
*   **配置管理 (`config.js`)**: 统一管理API基地址、调试模式开关等全局配置，解决了早期版本中常量重复声明和依赖混乱的问题。(参考 `版本更新与修复说明.md v2.1`) **该文件确保了前端各模块（如 `auth.js`, `main.js` 中涉及API调用的部分）使用一致的后端服务入口和行为参数，提高了代码的可维护性和配置的灵活性。**
*   **认证模块 (`auth.js`)**: 封装登录、登出、会话检查等逻辑。 **例如，`auth.js` 中的 `loginUser()` 函数会调用后端的 `/login` API，并处理响应，而 `checkLoginState()` 函数则用于在页面加载或路由切换时验证用户会话的有效性。**
*   **注册模块 (`register.js`)**: 处理用户注册、邮箱验证码发送与校验。 **`register.js` 负责构建注册表单的交互，并调用 `/register`, `/send_code`, `/verify_code` 等后端API。**
*   **加密模块 (`crypto.js`, `crypto_utils.py`)**: 实现前后端一致的离散对数加密算法。**前端 `crypto.js` 在用户输入密码后立即加密，后端 `crypto_utils.py` 提供相同的加密逻辑的Python版本（尽管在本项目中主要用于理解和可能的校验，实际比对的是密文），确保了密码在传输和存储过程中的端到端安全理念。**
*   **动态内容推送与个性化服务模块**:
    *   **核心机制**: 前端JavaScript (主要在 `main.html` 内的脚本)通过解析HTML元素上定义的 `data-hide-rule` (如 `show-only` 或 `hide-for`) 和 `data-hide-users` (指定用户类型列表，如 `student,teacher`) 属性，并结合URL中的 `&user=xxx` 访客身份参数，动态控制页面元素的显示（`element.style.display = ''`）或隐藏（`element.style.display = 'none'`）。这使得同一篇文章能够根据访问者的身份（例如，在校园场景中，可以是学生、教师、校友或访客等）呈现不同的内容区块。
    *   **与访客统计联动**: "访客统计"功能（数据由 `server.py` 记录到各文章目录下的 `accrecord.csv` 文件）会跟踪不同身份访客（通过 `&user=xxx` 参数识别）对特定文章或内容的访问频次。主页管理者（如校园网站管理员）可以分析这些统计数据，了解哪些内容模块更受特定用户群体的关注。基于这些洞察，管理员可以更有效地设置"动态隐藏"规则，从而向不同类别的用户推送最相关的信息，优化主页内容的针对性和信息传递的有效性。例如，如果发现"科研成果"模块主要被"教师"群体访问，而"校园招聘"模块主要被"学生"群体访问，则可以强化这些定向推送规则。

#### 3.2.3 数据库设计
考虑到系统的轻量化定位，我们选择了CSV文件作为主要的数据存储方式：
*   `users.csv`: 存储用户信息，包括`username`, `password` (加密后), `maxarticle` (文章配额)。 (参考 `版本更新与修复说明.md v1.1 注册系统升级详解`) **`maxarticle` 字段的设计是为了限制每个用户可创建的文章数量，作为一种简单的资源管理机制，默认为30篇。这有助于防止滥用，并为未来可能的付费增值服务提供技术铺垫。**
*   `registration_checklist.json`: 定义新用户注册时的自动化操作清单，如创建用户文件夹、初始化子目录等，增强了注册流程的可维护性。 **这个JSON文件实际上充当了一个轻量级的配置管理和流程控制角色，使得注册后继操作（如在 `../workplace/<username>/`下创建 `article` 和 `pics` 目录）更加清晰和易于修改。**
*   `redirect.csv` (后演变为访客通道管理功能): 管理文章别名与实际路径的映射。 **此文件由 `server.py` 在处理别名访问请求时读取，将易记的别名解析为实际的文章文件路径。**
*   `accrecord.csv` (位于各文章目录下): 存储对应文章的访客类型统计数据。 **每当有访客通过别名或文章链接访问某篇文章时，若URL中带有 `&user=xxx` 参数，`server.py` 的相应逻辑会解析访客类型，并更新对应文章目录下的 `accrecord.csv` 文件，记录访客类型和访问次数。这为用户提供了简单的数据分析功能。**

#### 3.2.4 安全架构设计
系统的安全性是设计的重中之重，我们构建了三层安全防护体系 (详细参考 `系统安全性说明.md`):
1.  **访问控制安全**: 禁止未登录或会话过期的用户访问核心功能页面 (`main.html`)。通过前端 `checkAuth()` 和 `requireAuth()` 函数实现，结合会话超时（24小时）和活动检测机制。 **具体而言，`auth.js` 中的 `checkLoginState()`（或类似功能的函数）会在 `main.html` 加载时检查本地存储（如localStorage或sessionStorage）中的会话凭证（例如，一个登录成功后由后端签发并存储的简单token或标记）。若凭证无效或过期，`requireAuth()`（或页面加载时的重定向逻辑）会将用户导向登录页面 (`index.html`)。用户在 `main.html` 上的活动（如API请求）会刷新后端的会话计时器（通过 `server.py` 中的会话管理机制）。**
2.  **身份验证安全**: 账号注册强制绑定邮箱验证。后端实现邮箱唯一性检查、SMTP邮件验证码发送（6位数字，10分钟有效期，5次错误限制）、注册频率限制（60秒间隔）。 **这些措施由 `server.py` 中的 `/register`, `/send_code`, `/verify_code` 等接口的具体逻辑实现，有效防止了恶意注册和账户盗用。**
3.  **密码传输与存储安全**: 采用**离散对数端到端加密**。
    *   **前端加密**: 用户密码在浏览器端通过 `crypto.js` 的 `convertToEncryptedHex()` 函数加密成16字节密文。
    *   **密文传输**: 网络中仅传输加密后的密码。
    *   **后端盲比对**: 服务器 `server.py` 仅对接收到的密文和存储的密文进行字符串比对，不进行解密操作，永远不接触明文密码。 **这是通过在用户登录 (`/login` API) 和密码修改 (`/update_password` API) 时，直接比较请求体中的加密密码与 `users.csv` 中存储的加密密码字符串是否一致来实现的。**
    *   **密文存储**: `users.csv` 中存储的是加密后的密码。
    *   **加密参数**: p = 2305843009213693951 (2^61-1), g = 37。私钥通过字符ASCII码位移异或生成。 **选择这些参数和私钥生成方式是自定义加密方案的一部分，旨在提供一定程度的安全性，尽管其强度和标准性可能不如业界成熟的加密库。**

#### 3.2.5 系统建模图表

为了更清晰地展示Schomepage系统的架构和设计，我们采用软件工程中的标准建模方法，绘制了ER图、类图和顺序图来描述系统的数据模型、静态结构和动态行为。

**一、实体关系图（ER图）**

Schomepage系统的数据模型主要基于CSV文件存储，包含以下核心实体和关系：

```
实体定义：
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│     用户(User)   │    │   文章(Article)  │    │   图片(Image)    │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ username (PK)   │    │ filename (PK)   │    │ filename (PK)   │
│ password        │◄──┐│ title           │    │ upload_time     │
│ maxarticle      │   ││ content         │    │ file_size       │
│ created_time    │   ││ created_time    │    │ file_path       │
└─────────────────┘   │└─────────────────┘    └─────────────────┘
                      │         │                      │
                      │         │1:N                   │1:N
                      │         ▼                      ▼
┌─────────────────┐   │┌─────────────────┐    ┌─────────────────┐
│  访客通道(Alias) │   ││ 访客记录(Access) │    │ 动态隐藏(Dynamic)│
├─────────────────┤   ││     Record      │    │    Hide Rule    │
│ alias_name (PK) │   │├─────────────────┤    ├─────────────────┤
│ target_article  │───┘│ visitor_type    │    │ element_id      │
│ owner_username  │    │ access_count    │    │ hide_rule       │
│ created_time    │    │ last_access     │    │ target_users    │
└─────────────────┘    └─────────────────┘    └─────────────────┘

实体关系说明：
1. 用户(User) 1:N 文章(Article) - 一个用户可以创建多篇文章
2. 用户(User) 1:N 图片(Image) - 一个用户可以上传多张图片
3. 用户(User) 1:N 访客通道(Alias) - 一个用户可以创建多个访客通道别名
4. 文章(Article) 1:1 访客记录(Access Record) - 每篇文章对应一个访客统计记录
5. 文章(Article) 1:N 动态隐藏(Dynamic Hide Rule) - 一篇文章内可有多个动态隐藏规则

数据存储映射：
- 用户实体 → users.csv
- 文章实体 → ../workplace/<username>/article/<filename>.html
- 图片实体 → ../workplace/<username>/pics/<filename>
- 访客通道实体 → redirect.csv
- 访客记录实体 → ../workplace/<username>/article/<article_dir>/accrecord.csv
- 动态隐藏实体 → 嵌入在文章HTML的data-hide-rule属性中
```

**二、类图（Class Diagram）**

系统采用前后端分离架构，主要类结构如下：

```
后端核心类结构（server.py）：
┌──────────────────────────────────────┐
│            FlaskApplication          │
├──────────────────────────────────────┤
│ + app: Flask                         │
│ + CORS: Flask-CORS                   │
├──────────────────────────────────────┤
│ + index() -> str                     │
│ + login() -> Response                │
│ + register() -> Response             │
│ + send_verification_code() -> Response│
│ + verify_code() -> Response          │
│ + get_articles() -> Response         │
│ + save_article() -> Response         │
│ + upload_image() -> Response         │
│ + alias_access() -> Response         │
└──────────────────────────────────────┘
                    │
                    │depends on
                    ▼
┌──────────────────────────────────────┐
│           CryptoUtils                │
├──────────────────────────────────────┤
│ + P: int = 2305843009213693951       │
│ + G: int = 37                        │
├──────────────────────────────────────┤
│ + convertToEncryptedHex() -> str     │
│ + generatePrivateKey() -> int        │
│ + modularExponentiation() -> int     │
└──────────────────────────────────────┘

前端核心类结构（JavaScript模块）：
┌──────────────────────────────────────┐
│             AuthManager              │
├──────────────────────────────────────┤
│ + currentUser: string                │
│ + sessionToken: string               │
├──────────────────────────────────────┤
│ + loginUser() -> Promise<boolean>    │
│ + logoutUser() -> void               │
│ + checkLoginState() -> boolean       │
│ + requireAuth() -> void              │
└──────────────────────────────────────┘

┌──────────────────────────────────────┐
│            EditorManager             │
├──────────────────────────────────────┤
│ + canvas: HTMLElement                │
│ + selectedElement: HTMLElement       │
│ + undoStack: Array<State>            │
│ + redoStack: Array<State>            │
├──────────────────────────────────────┤
│ + addTextElement() -> void           │
│ + addImageElement() -> void          │
│ + deleteElement() -> void            │
│ + updateElementProperty() -> void    │
│ + saveArticle() -> Promise<void>     │
│ + loadArticle() -> Promise<void>     │
│ + undo() -> void                     │
│ + redo() -> void                     │
└──────────────────────────────────────┘

┌──────────────────────────────────────┐
│          CryptoService               │
├──────────────────────────────────────┤
│ + P: number = 2305843009213693951    │
│ + G: number = 37                     │
├──────────────────────────────────────┤
│ + convertToEncryptedHex() -> string  │
│ + generatePrivateKey() -> number     │
│ + modularExponentiation() -> number  │
└──────────────────────────────────────┘

┌──────────────────────────────────────┐
│         DynamicHideManager           │
├──────────────────────────────────────┤
│ + currentUserType: string            │
│ + hideRules: Map<string, Rule>       │
├──────────────────────────────────────┤
│ + parseUserFromURL() -> string       │
│ + applyHideRules() -> void           │
│ + setElementHideRule() -> void       │
│ + removeHideRule() -> void           │
└──────────────────────────────────────┘

类关系说明：
1. FlaskApplication 聚合 CryptoUtils，用于密码加密验证
2. AuthManager 依赖 CryptoService，实现前端密码加密
3. EditorManager 组合 DynamicHideManager，管理编辑器内的动态隐藏功能
4. 前后端通过RESTful API进行交互，遵循依赖倒置原则
```

**三、顺序图（Sequence Diagram）**

**1. 用户注册流程顺序图：**
```
用户    注册页面   前端加密   后端API    邮件服务    CSV存储
 │        │         │         │         │         │
 │输入信息 │         │         │         │         │
 ├──────→│         │         │         │         │
 │        │点击注册  │         │         │         │
 │        ├───────→│         │         │         │
 │        │        │加密密码  │         │         │
 │        │        ├───────→│         │         │
 │        │        │        │验证邮箱   │         │
 │        │        │        ├───────→│         │
 │        │        │        │        │发送验证码│
 │        │        │        │        ├───────→用户邮箱
 │输入验证码        │        │        │         │
 ├──────→│         │         │         │         │
 │        │验证码校验│        │         │         │
 │        ├───────→│         │         │         │
 │        │        │        │写入用户数据        │
 │        │        │        ├─────────────────→│
 │        │        │        │创建工作目录        │
 │        │        │        ├─────────────────→文件系统
 │        │        │        │注册成功   │         │
 │        │        │◄───────┤         │         │
 │        │◄───────┤        │         │         │
 │◄──────┤        │        │         │         │
 │注册完成│        │        │         │         │
```

**2. 文章编辑与保存流程顺序图：**
```
用户    编辑器     属性面板   素材库    后端API    文件系统
 │        │         │         │         │         │
 │拖拽元素 │         │         │         │         │
 ├──────→│         │         │         │         │
 │        │创建DOM元素        │         │         │
 │        ├─────────┐        │         │         │
 │        │        │        │         │         │
 │        │◄────────┘        │         │         │
 │选中元素 │         │         │         │         │
 ├──────→│         │         │         │         │
 │        │显示属性  │         │         │         │
 │        ├───────→│         │         │         │
 │修改属性 │         │         │         │         │
 ├─────────────────→│         │         │         │
 │        │更新DOM  │         │         │         │
 │        │◄────────┤         │         │         │
 │插入图片 │         │         │         │         │
 ├──────→│         │         │         │         │
 │        │打开素材库│         │         │         │
 │        ├───────→│         │         │         │
 │        │        │选择图片  │         │         │
 │        │        ├───────→│         │         │
 │        │        │        │获取图片路径        │
 │        │        │        ├───────→│         │
 │        │        │        │◄───────┤         │
 │        │插入图片元素       │         │         │
 │        │◄─────────────────┤         │         │
 │保存文章 │         │         │         │         │
 ├──────→│         │         │         │         │
 │        │获取HTML内容       │         │         │
 │        ├─────────┐        │         │         │
 │        │        │        │         │         │
 │        │◄────────┘        │         │         │
 │        │发送保存请求       │         │         │
 │        ├─────────────────────────────→│         │
 │        │                 │         │写入文件  │
 │        │                 │         ├───────→│
 │        │                 │         │◄───────┤
 │        │保存成功          │         │         │
 │        │◄────────────────────────────┤         │
 │◄──────┤                 │         │         │
 │保存完成│                 │         │         │
```

**3. 动态隐藏模块访问流程顺序图：**
```
访客    浏览器    前端JS   后端API   访客统计   文件系统
 │        │        │        │        │        │
 │访问别名URL     │        │        │        │
 │(带user参数)   │        │        │        │
 ├──────→│        │        │        │        │
 │        │发送请求│        │        │        │
 │        ├──────→│        │        │        │
 │        │       │解析别名 │        │        │
 │        │       ├──────→│        │        │
 │        │       │       │读取文章 │        │
 │        │       │       ├────────────────→│
 │        │       │       │◄───────────────┤
 │        │       │       │记录访客统计     │
 │        │       │       ├──────→│        │
 │        │       │       │       │更新CSV │
 │        │       │       │       ├──────→│
 │        │       │返回HTML │       │◄──────┤
 │        │       │◄──────┤       │        │
 │        │◄──────┤       │       │        │
 │        │解析user参数    │       │        │
 │        ├────────┐      │       │        │
 │        │       │      │       │        │
 │        │◄───────┘      │       │        │
 │        │应用隐藏规则    │       │        │
 │        ├────────┐      │       │        │
 │        │       │      │       │        │
 │        │◄───────┘      │       │        │
 │        │渲染最终页面    │       │        │
 │        ├────────┐      │       │        │
 │        │       │      │       │        │
 │        │◄───────┘      │       │        │
 │◄──────┤       │      │       │        │
 │看到个性化内容  │      │       │        │
```

这些建模图表清晰地展示了Schomepage系统的数据结构、静态架构和关键业务流程的动态交互，为系统的理解、维护和后续开发提供了重要的参考依据。

### 3.3 实现与编码 (2025年4月中旬 - 5月下旬)
在实现阶段，团队成员分工协作，定期进行代码合并与评审。
*   **潘旭**: 主要负责后端逻辑开发，包括Flask API接口设计（如 `server.py` 中定义的用户认证、文章管理、文件上传等路由）、用户认证（包括 `/login`, `/register` 的具体实现）、数据库操作（CSV文件的读写封装）、邮件服务集成（SMTP邮件发送逻辑）、安全性关键逻辑实现（如会话管理、加密密码比对）。
*   **韦先轶**: 主要负责前端编辑器核心功能的开发，包括画布交互（`main.html` 中画布区域的DOM操作）、元素拖拽（JavaScript实现的拖放逻辑）、属性面板（与选中元素动态绑定的表单）、文本/图片编辑（innerHTML修改、图片元素属性设置）、素材库对接（调用后端API获取素材列表并在前端展示）、动态隐藏模块（解析 `data-hide-rule` 并控制元素 `display` 属性）等。
*   **刘远巍**: 主要负责前端用户界面和流程逻辑，包括登录/注册界面（`index.html`, `register.html` 及对应的 `auth.js`, `register.js`）、主页布局（`main.html` 的整体结构和CSS样式）、文章链接功能（生成特定格式URL，处理链接跳转）、访客通道管理界面（调用API管理别名数据）、以及整体UI/UX优化（如自定义对话框、加载提示等）。

**关键功能实现亮点:**
*   **可视化编辑器**: 通过原生JavaScript直接操作DOM，实现了元素的动态添加、删除、修改、拖拽。属性面板与选中元素实时双向绑定。**例如，当用户从工具栏拖拽一个文本框到画布时，JavaScript会创建一个新的 `div` 元素，赋予其可编辑属性（`contenteditable="true"`），并添加到画布对应的DOM节点中。选中元素时，其属性（如字号、颜色）会填充到右侧属性面板，修改面板值会通过事件监听实时更新到DOM元素样式上。**
*   **动态隐藏模块**: 前端通过为元素设置 `data-hide-rule` (如 `show-only:student,teacher` 或 `hide-for:tourist`) 和 `data-hide-users` 属性 (对应 `main.html` 实现中的 `element.getAttribute('data-hide-users')` )，结合访客URL中的 `&user=xxx` 参数，由JavaScript动态判断元素的显示与隐藏。**例如，在校园主页场景下，可以轻松实现将"选课通知"模块配置为仅对 `user=student` 的访客显示，而将"教职工会议纪要"配置为仅对 `user=teacher` 显示。主页管理员还可以根据"访客统计"中不同类型用户对各模块的实际访问数据，调整这些动态显示规则，以达到最佳的信息传递效果。** 服务器端在返回别名访问的文章HTML时，会根据访客类型注入相应的处理脚本。(参考 `代码更新与修复说明.md` 中动态隐藏模块的修复过程)
*   **文章链接功能**: 用户可在编辑器中选择目标文章，生成形如 `/link/<username>/<filename>?from=<source_article>` 的链接。后端Flask捕获此路由，读取目标文章内容，并使用预设的绿色主题模板 (`LINK_TEMPLATE`) 渲染页面，同时提供返回上级功能。(参考 `代码更新与修复说明.md` 修复5)
*   **~~Windows安装包 (`setup.py`)~~**: ~~实现了自动检查Python环境、安装依赖（Flask, Flask-CORS, PyInstaller）、打包生成 `schomepage.exe`（无控制台窗口，自动打开浏览器到 `localhost:5000`），并生成 `README.txt` 用户指南。(参考 `Windows安装包制作说明.md`)~~ **(重要更新：在项目交付前夕的最终调试阶段，`setup.py` 生成的一键安装包 `schomepage.exe` 被发现存在重大稳定性和安全漏洞。考虑到修复时间窗口不足，团队决定暂时移除此一键安装功能。当前版本要求用户手动安装Python环境、通过命令行启动 `server.py` 后端服务，并手动在浏览器访问 `localhost:5000`。此功能计划在后续版本中得到修复和完善。)**

**迭代与问题解决实例 (参考 `版本更新与修复说明.md`)**: 
*   **v2.1 JS模块化改进**: 初期开发中，JavaScript全局变量和函数较多，易产生冲突且难以管理。通过引入 `config.js` 统一管理API端点等配置，并对其他JS文件进行功能聚焦和封装（如 `auth.js` 专职认证，`editor_functions.js` 存放编辑器核心操作），提升了代码的模块化程度和可维护性。
*   **v2.0 安全性增强**: 实现了用户密码的端到端加密。前端 `crypto.js` 对密码进行加密处理后才发送给后端，后端 `server.py` 直接比对密文，不存储明文密码，增强了用户数据的安全性。
*   **Bug修复**: 例如，"无登录访问模式路由冲突"问题，最初Flask的通配符路由 `/<a>` 错误地拦截了对静态资源（如 `/static/css/style.css`）的请求。通过在路由处理函数中增加对文件名后缀的判断，优先服务已知的静态文件路径或API路径，才解决了此问题。

### 3.4 测试 (2025年5月下旬 - 6月初)
测试是确保软件质量的关键环节。我们采用了多种测试方法：
*   **单元测试**: 对后端的关键API接口（如登录、获取文章列表、获取访客统计）使用 `curl` 命令或Postman等工具进行参数和返回值的测试。对前端的关键函数（如加密函数、表单验证函数）进行独立测试。
    *   **后端API示例**: 测试 `/login` 接口：使用正确的用户名和加密密码，预期返回成功状态码和会话信息；使用错误的密码，预期返回失败状态码和错误提示。
    *   **前端函数示例**: 测试 `crypto.js` 中的 `convertToEncryptedHex("password123", "testuser")` 是否能稳定生成预期的密文输出，以及对于不同输入是否产生不同输出。
*   **集成测试**: 测试前后端模块的协同工作，例如：
    *   注册流程：从前端输入用户信息、点击注册、后端接收数据、写入 `users.csv`、创建用户专属文件夹（如 `../workplace/newuser/article` 和 `../workplace/newuser/pics`），并返回成功响应给前端显示的全过程。
    *   文章保存与加载：在编辑器中修改内容后点击保存，验证后端 `server.py` 的 `/api/save_article` 接口是否正确接收数据并写入相应的文章HTML文件；然后刷新页面或重新打开文章，验证内容能否从后端正确加载并显示在编辑器中。
    *   动态隐藏：在编辑器中为一个元素设置 `show-only:student` 规则，保存文章。然后通过访客通道URL `http://localhost:5000/别名&user=student` 访问，验证该元素是否显示；再以 `http://localhost:5000/别名&user=teacher` 访问，验证该元素是否隐藏。
*   **系统测试/用户验收测试 (UAT)**: 模拟最终用户的使用场景，对系统的所有功能进行端到端测试。例如，完整体验从注册、登录、创建文章、插入图文、设置动态隐藏、生成访客链接、到其他用户访问该链接的整个流程。参考 `工作页面使用介绍.md` 中描述的完整功能演示步骤。
*   **兼容性测试**: 在主流浏览器（Chrome, Firefox, Edge）上测试页面显示和功能表现。
*   **回归测试**: 在每次修复Bug或添加新功能后，重新执行相关测试用例，确保原有功能未受影响。这在解决"无登录访问模式路由冲突"（修复后需验证别名访问和静态资源加载均正常）、"撤销重做功能完善"（修复后需验证编辑操作和撤销重做的准确性）等问题时尤为重要。(参考 `代码更新与修复说明.md`) **例如，在修复了动态隐藏模块的一个逻辑错误后，不仅要测试该错误场景，还要重新测试所有其他动态隐藏规则（如 `hide-for`）以及不设置规则时的默认行为，确保修复没有引入新的问题。**

**3.4.1 软件测试详述**

为了确保Schomepage主页生成系统V2.5版本的质量，团队在开发周期的后期（主要集中在2025年5月下旬至6月初）进行了一系列测试活动。本报告旨在概述测试的策略、范围、方法和主要结果。

**一、 测试目标与范围**
*   **测试目标**：
    *   验证系统的核心功能（用户管理、内容编辑、动态展示、访客管理等）是否符合需求规格。
    *   评估系统的稳定性和基本安全性。
    *   确保手动部署流程的可行性和用户文档的准确性（尤其是在一键安装包被移除后）。
*   **测试范围**：
    *   后端API接口 (`server.py`)。
    *   前端核心逻辑 (JavaScript模块如 `auth.js`, `crypto.js`, 编辑器交互逻辑)。
    *   用户界面 (UI) 与用户体验 (UX) (`main.html` 及相关CSS)。
    *   主要用户故事和业务流程。
    *   安全机制（访问控制、身份验证、密码加密）。
    *   手动安装和启动过程。

**二、 测试策略**
本次测试采用黑盒测试与白盒测试相结合的策略：
*   **自动化测试**：针对重复性高、逻辑明确的部分（如API接口、前端单元逻辑）编写脚本进行测试，以提高效率和覆盖率。
*   **手动测试**：针对UI/UX、复杂交互、探索性安全测试以及安装文档的易用性等，进行人工操作和验证。

**三、 自动化测试**

1.  **后端API接口测试 (`server.py`)**
    *   **适用场景**：用户认证（登录、注册、发送/校验验证码、修改密码）、文章管理（创建、保存、加载、删除、列表获取）、图片上传、访客通道别名解析、访客统计记录等API端点。
    *   **测试脚本构建思路 (Python + requests 伪代码)**：
        ```pseudocode
        // 初始化测试客户端，可能包含登录获取会话凭证的辅助函数
        Setup TestClient with base_url = "http://localhost:5000"

        // 测试用户注册API
        Function Test_User_Registration_API:
          payload_valid = {email: "newuser@example.com", password_encrypted: "encrypted_pw", vcode: "123456"}
          response = TestClient.POST("/register", data=payload_valid)
          Assert response.status_code == 200
          Assert response.json["message"] == "注册成功"
          // 验证后端是否已创建用户数据和目录 (可能需要辅助的文件系统检查)

          payload_invalid_email = {email: "invalid_email", ...}
          response = TestClient.POST("/register", data=payload_invalid_email)
          Assert response.status_code == 400 // 或其他错误码
          Assert "邮箱格式不正确" in response.json["error"]
        EndFunction

        // 测试文章保存API
        Function Test_Article_Save_API:
          // 步骤1: 用户登录获取凭证 (假设已有 login_user() 辅助函数)
          session_token = login_user("testuser@example.com", "encrypted_password")

          article_data = {article_name: "my_test_article.html", html_content: "<h1>Test</h1>", token: session_token}
          response = TestClient.POST("/api/save_article", data=article_data)
          Assert response.status_code == 200
          Assert response.json["message"] == "文章保存成功"
          // 验证服务器对应路径下文章文件内容是否正确
        EndFunction
        ```
    *   **主要测试点**：接口的正常响应、异常输入处理（如错误参数、缺失参数）、边界值、权限控制（未登录用户访问受保护API）、数据持久化正确性（如CSV文件和文章HTML文件）。

2.  **前端单元测试 (JavaScript)**
    *   **适用场景**：核心的、独立的JavaScript函数模块，如 `crypto.js` 中的加密函数、表单验证逻辑、`data-hide-rule` 解析函数等。
    *   **测试脚本构建思路 (Jest/Mocha 风格伪代码)**：
        ```pseudocode
        // crypto.test.js
        Describe "EncryptionService - convertToEncryptedHex":
          It "should return a 16-byte hex string for valid inputs":
            encrypted = crypto.convertToEncryptedHex("testPassword123", "testUser");
            Assert typeof encrypted === "string";
            Assert encrypted.length === 32; // 16 bytes * 2 hex chars per byte
            Assert /^[0-9a-f]+$/.test(encrypted); // Check if hex

          It "should produce a consistent output for the same input":
            encrypted1 = crypto.convertToEncryptedHex("testPassword123", "testUser");
            encrypted2 = crypto.convertToEncryptedHex("testPassword123", "testUser");
            Assert encrypted1 === encrypted2;

          It "should produce different outputs for different passwords or usernames":
            encrypted_diff_pw = crypto.convertToEncryptedHex("differentPassword", "testUser");
            encrypted_diff_user = crypto.convertToEncryptedHex("testPassword123", "anotherUser");
            Assert encrypted1 !== encrypted_diff_pw;
            Assert encrypted1 !== encrypted_diff_user;
        EndDescribe
        ```
    *   **主要测试点**：函数输出的正确性、边界条件处理、对不同输入的响应。

**四、 手动测试**

1.  **UI/UX 与核心编辑器功能测试**：
    *   **范围**：登录/注册界面、主界面布局 (`main.html`)、元素（文本、图片、图案）的拖拽、添加、删除、修改、属性面板的实时双向绑定、格式化工具栏、撤销/重做功能。
    *   **方法**：模拟不同用户角色进行操作，关注界面美观性、交互流畅性、操作便捷性、提示信息友好性。

2.  **高级交互功能测试**：
    *   **文章链接**：创建多个文章，在文章A中创建指向文章B的链接，验证链接是否能正确跳转到绿色主题的文章B页面，并能返回。
    *   **动态隐藏模块**：针对不同元素设置 `show-only` 和 `hide-for` 规则（如 `student`, `teacher`, `tourist` 等组合），通过访客通道URL `&user=xxx` 参数切换不同访客身份，验证元素显隐是否符合预期。测试无 `user` 参数时的默认行为。
    *   **访客通道管理**：创建、修改、删除别名，验证通过别名访问的正确性。
    *   **访客统计**：通过不同身份访问文章后，检查对应 `accrecord.csv` 文件的数据是否准确记录。

3.  **兼容性测试**：
    *   在主流浏览器（Chrome, Firefox, Edge 最新稳定版）上重复执行核心功能和UI检查，确保显示和功能的一致性。

4.  **安全性探索测试**：
    *   尝试未登录访问需授权页面或API。
    *   测试邮箱注册流程中的验证码有效性、过期机制、错误次数限制、发送频率限制。
    *   检查密码在网络传输中是否确实为密文（浏览器开发者工具）。
    *   尝试输入恶意脚本或特殊字符到文本框，观察是否有XSS等基本过滤（尽管主要为本地应用，良好习惯仍重要）。

5.  **手动安装与文档可用性测试**：
    *   由不熟悉项目的成员，严格按照 `README.txt` 中的手动安装步骤，在干净的环境中尝试部署和启动系统，记录遇到的问题和文档描述不清之处。

**五、 测试环境**
*   **操作系统**：Windows 10 Pro, Windows 11 Home
*   **Python版本**：Python 3.13.4
*   **主要浏览器**：Google Chrome (最新版), Mozilla Firefox (最新版), Microsoft Edge (最新版)
*   **后端依赖**：Flask, Flask-CORS (按 `README.txt` 安装)

**六、 测试结果与分析**

*   **核心功能模块通过情况**：
    *   用户管理系统（注册、登录、邮箱验证、密码修改）功能基本稳定，通过了自动化API测试和手动流程测试。
    *   核心编辑器功能（文本、图片、图案的增删改、拖拽、属性调整、格式化）在手动测试中表现良好，满足基本编辑需求。
    *   文章管理（创建、保存、加载、删除）后端API测试通过，前端操作流程顺畅。
    *   素材库（背景图、图标库、用户图片上传与使用）功能符合预期。
    *   文章链接、动态隐藏模块、访客通道及访客统计等高级交互功能，在手动详细测试下，按设计逻辑正确运行。
    *   前端加密逻辑 (`crypto.js`) 通过了单元测试。

*   **发现的主要问题与处理**：
    1.  **严重问题 - Windows安装包 (`setup.py`) 功能缺陷 (P0)**：
        *   **描述**：在项目后期构建和测试通过 `setup.py` (使用PyInstaller) 生成的 `schomepage.exe` 一键安装包时，发现其在部分测试环境下存在严重的稳定性问题（如程序无故崩溃、资源文件加载失败）和潜在的安全隐患（如权限控制不当）。
        *   **原因分析**：可能与PyInstaller打包复杂Flask应用时的依赖处理、路径映射、或与特定系统环境冲突有关。由于时间窗口限制，未能彻底定位和修复根本原因。
        *   **处理**：鉴于问题的严重性和修复的紧迫性，团队决定在V2.5版本中 **暂时移除一键安装功能**，改为引导用户进行手动安装和启动。相关文档 (`README.txt` 和本报告) 已更新以反映此变更。
    2.  **一般缺陷 - 撤销/重做功能偶现不精确 (P2)**：
        *   **描述**：在复杂或连续快速的编辑操作后，撤销/重做有时未能完全恢复到预期状态，或丢失部分步骤。
        *   **处理**：已记录此问题，由于 `MutationObserver` 实现的复杂性，计划在后续版本中进一步优化和增强其鲁棒性。
    3.  **优化建议 - 部分错误提示不够友好 (P3)**：
        *   **描述**：某些后端API错误或前端操作异常时，返回给用户的提示信息较为技术化或不够明确。
        *   **处理**：已记录，计划在后续版本中统一和改进错误处理机制和用户提示文案。

*   **当前版本状态 (V2.5)**：
    *   核心功能在手动部署和启动的前提下，运行稳定，满足设计要求。
    *   由于一键安装功能的移除，用户初次使用的便捷性受到较大影响，对非技术用户不够友好。
    *   已知存在一些次要缺陷和待优化点。

*   **测试覆盖率与局限性**：
    *   后端API的关键路径基本被自动化测试覆盖。
    *   前端JavaScript的单元测试主要集中在加密等独立模块，对于复杂的UI交互逻辑覆盖有限。
    *   手动测试尽可能覆盖了所有用户故事和主要功能路径，但未进行大规模并发测试、性能压力测试或专业的安全渗透测试。
    *   兼容性测试主要在主流浏览器最新版本进行，未覆盖旧版本或非主流浏览器。

**七、 总结与建议**
Schomepage主页生成系统V2.5的核心功能已按预期实现，并通过了主要测试用例。然而，原定的一键安装包因在最后阶段发现严重问题而被移除，这成为当前版本最主要的遗憾。建议：
1.  **最高优先级**：在后续迭代中，投入足够资源解决打包问题，提供稳定可靠的一键安装体验，或探索其他更成熟的桌面应用分发方案。
2.  **持续完善自动化测试**：逐步增加API测试覆盖率，特别是针对权限和边界条件的用例。扩展前端单元测试和集成测试，特别关注编辑器核心交互逻辑。
3.  **缺陷修复与体验优化**：跟进已记录的缺陷（如撤销/重做问题），优化用户交互和错误提示。
4.  **加强文档**：根据用户反馈，持续优化安装指南和使用手册的清晰度。

总体而言，V2.5版本作为一个重要的里程碑，验证了核心架构和功能的可行性，但部署便捷性方面的不足需要在未来版本中重点弥补。

### 3.5 部署与维护
*   **部署**: ~~最终交付物包括一个Windows安装包。用户通过运行 `setup.exe` 可以自动安装Python环境（如果缺失）、项目依赖，并生成 `schomepage.exe` 启动程序。双击 `schomepage.exe` 即可启动本地服务器并自动打开浏览器访问 `http://localhost:5000`。~~ **(重要更新：由于 `setup.exe` 一键安装功能在最终调试时发现重大漏洞且时间紧急，当前版本的部署方式已调整为手动部署。用户需要：1. 自行确保已安装Python (3.7+)。2. 手动安装依赖包 (`pip install flask flask-cors`)。3. 通过命令行 (`python server.py`) 在 `login` 目录下启动后端服务。4. 手动在浏览器中打开 `http://localhost:5000` 来访问应用。相关的 `setup.py` 及 `schomepage.exe` 功能已暂停使用，计划在未来版本修复。) 详细的手动部署步骤已更新至 `README.txt` 用户指南中。**
*   **版本控制**: 项目开发过程中使用Git进行版本控制（假设，标准实践）。发布的版本均有明确的更新说明，如 `版本更新与修复说明.md` 中详细记录了从v1.0到v2.5的演进。
*   **文档维护**: 编写了详细的用户文档 (`README.txt`, `工作页面使用介绍.md`) 和开发者文档 (`版本更新与修复说明.md`, `系统安全性说明.md`, `Windows安装包制作说明.md` **(关于Windows安装包制作的部分内容当前已不完全适用)**, 本报告)。
*   **未来维护计划**: 在 `代码更新与修复说明.md` 中规划了短期、中期和长期的功能迭代方向。

---

## 4. 软件特性与功能详解

Schomepage主页生成系统具备以下主要特性和功能：

### 4.1 核心编辑器功能
*   **可视化编辑界面**: 类似Word的半图形化界面，主编辑区为画布，左侧为功能导航，右侧为属性面板。
*   **元素插入**:
    *   **文本框**: 支持富文本编辑。
    *   **图片**: 支持从本地上传、素材库选择（背景图、图标库、用户个人图片）。
    *   **图案**: 预设矩形、圆形、分割线、引用框等。
*   **格式化工具栏**: 提供字体选择、字号设置、加粗、斜体、下划线、文本对齐（左、中、右）等常用格式化选项。
*   **属性面板**: 选中元素后，可在右侧面板实时调整其具体属性，如颜色、背景色、宽度、高度、边距、动态隐藏规则等。
*   **元素控制**: 支持元素的拖拽排序、删除、上移、下移。
*   **撤销/重做**: 支持多级撤销和重做，基于MutationObserver监听DOM变化自动保存状态。

### 4.2 用户管理与安全
*   **用户注册**:
    *   邮箱作为唯一用户名。
    *   强制邮箱验证（10分钟有效6位数字验证码，5次尝试机会，60秒发送间隔）。
    *   自动创建用户工作目录 (`../workplace/<username>/article`, `../workplace/<username>/pics`)。
    *   新用户默认文章配额为30篇。
*   **用户登录**:
    *   前端密码加密后传输。
    *   后端进行密文比对。
    *   会话管理（24小时超时，用户活动自动续期）。
*   **密码修改**: 支持用户修改密码，同样采用端到端加密流程。
*   **密码安全**:
    *   采用自定义的离散对数加密算法，确保密码在传输和存储过程中的安全。
    *   服务器不存储明文密码，有效防止因服务器数据泄露导致的密码明文暴露。

### 4.3 内容管理与发布
*   **文章管理**:
    *   创建新文章（自动处理命名冲突）。
    *   文章列表展示（显示文章名及修改时间）。
    *   打开、重命名、删除文章。
    *   文章存储在用户专属目录下的 `article` 文件夹内。
*   **素材库**:
    *   **背景图片**: 内置多张高质量WebP背景图。
    *   **图标库**: 提供SVG图标资源。
    *   **我的图片**: 用户可上传、管理个人图片（支持PNG, JPG, JPEG，最大5MB），图片存储在用户专属目录下的 `pics` 文件夹。
    *   素材预览统一为120x120px纯图像，点击即可使用。
*   **模板系统**: 提供文章、博客、新闻等多种预设模板，方便用户快速开始创作。

### 4.4 高级交互功能
*   **文章链接**:
    *   支持将文本或图片元素转换为指向用户自己工作站内其他文章的链接。
    *   生成的链接页面采用特定绿色主题，并提供返回上级文章的导航按钮。
*   **动态隐藏模块**:
    *   允许用户为文章中的任意元素（文本、图片等）设置显示规则。
    *   规则类型：**只给谁看** (白名单，如 `student,teacher`) 或 **不给谁看** (黑名单，如 `tourist`)。
    *   访客通过特定URL参数（如 `http://localhost:5000/别名&user=student`）访问时，页面会根据预设规则动态显示或隐藏相应内容。
    *   未提供 `user` 参数的匿名访问者，默认不显示"只给谁看"的内容，显示非"不给谁看"的内容。
    *   编辑时，被设置规则的元素会有红色视觉指示器（如 "🎭 仅显示: student"），该指示器在预览和访客模式下不可见。
*   **访客通道管理**:
    *   用户可以为自己的文章设置易于记忆的"别名"。
    *   访客可通过 `http://localhost:5000/别名` 的形式访问文章。
    *   支持为同一文章创建多个不同别名。
    *   用户只能管理自己工作文件夹下的访客通道记录。
*   **访客统计**:
    *   系统记录通过别名或文章链接访问文章的访客类型及次数。
    *   用户可在编辑器左侧"访客统计"模块查看统计数据，了解不同内容的受欢迎程度。

### 4.5 系统易用性与部署
*   **用户界面**: 简洁直观的单页应用（SPA）风格，主要操作集中在 `main.html`。
*   **~~Windows安装包~~**: ~~提供 `setup.exe` 一键安装程序。~~
    *   ~~自动检测并安装Python 3.13.4 (如果缺失)。~~
    *   ~~自动安装项目依赖 (Flask, Flask-CORS, PyInstaller)。~~
    *   ~~生成 `schomepage.exe` 主程序，双击即可后台启动服务器并自动在浏览器中打开 `http://localhost:5000`。~~
    *   ~~安装过程无需用户进行复杂配置。~~
    **(重要更新：原计划的 `setup.exe` 一键安装功能因重大漏洞已在当前版本移除。用户需参照 `README.txt` 中的手动安装和启动步骤操作。)**
*   **用户指南**: 提供详细的 `README.txt`，内容涵盖安装步骤、使用方法、功能介绍、故障排除等，方便新手用户快速上手。**(`README.txt` 已根据最新的手动安装流程进行了更新。)**
*   **快速启动脚本 (`quick_start.bat`)**: 为已有Python环境的用户提供便捷的启动方式。**(此脚本的有效性依赖于用户环境和项目文件结构，在当前手动部署为主的情况下，建议优先遵循完整的手动启动步骤以确保可靠性。)**

---

## 5. 项目管理与团队协作

在为期两个月（2025年4月初-6月初）的紧张开发周期中，团队协作和项目管理至关重要。
*   **任务分配**: 如3.3节所述，团队成员根据各自的技术特长和兴趣点进行了初步分工，潘旭负责后端与安全，韦先轶负责编辑器核心，刘远巍负责前端UI与流程。同时，对于复杂的模块或交叉点，会进行结对编程或共同讨论设计。
*   **沟通协作**:
    *   **定期会议**: 每周至少召开2-3次团队会议，同步进度、讨论遇到的问题、规划下阶段任务。
    *   **即时沟通**: 使用即时通讯工具进行日常沟通和快速问题解决。
    *   **共享代码库**: （假设）使用Git进行代码版本控制和协作，如GitHub或Gitee。
    *   **共享文档**: 所有项目文档（需求、设计、修复说明等）均进行电子化管理，团队成员可随时查阅。
*   **时间管理与进度控制**:
    *   **阶段划分**: 将项目划分为需求分析、设计、编码、测试、文档编写等阶段。
    *   **里程碑设定**: 为每个阶段设定关键里程碑和交付物。
    *   **敏捷迭代**: 虽然未严格遵循某一敏捷框架，但在开发过程中体现了迭代的思想，例如根据测试反馈快速修复Bug，根据使用体验优化功能。从 `版本更新与修复说明.md` 可以看到多个版本的迭代和功能完善过程。
*   **风险管理**:
    *   **技术风险**: 如初期遇到的JavaScript模块冲突（通过引入`config.js`解决）、API端点不一致（通过统一 `/send_code` 解决）。
    *   **进度风险**: 通过定期检查进度和调整任务优先级来应对。
    *   **质量风险**: 通过多轮测试和代码评审来降低。例如，图片路径问题、无登录访问路由冲突等都是在测试中发现并修复的。

---

## 6. 总结与展望

### 6.1 项目成果总结
通过团队成员潘旭、韦先轶、刘远巍的共同努力，Schomepage主页生成系统项目在预定时间内（2025年4月初至6月初）成功完成。系统实现了预期的核心功能，包括一个功能完善的可视化HTML编辑器、安全可靠的用户管理体系、灵活的动态内容展示机制。~~以及便捷的Windows安装部署方案。~~最终软件版本为v2.5稳定版，达到了生产环境就绪状态。

**需要特别指出的是，原计划作为重要交付成果之一的 `setup.exe` 一键安装包，在项目临近结束的最终调试阶段暴露出重大漏洞。为保证项目按时交付核心可用功能，团队不得不做出艰难决定，暂时移除了该安装方式，转为要求用户手动安装和启动。这无疑对软件的易用性造成了影响，也使得原定的"便捷部署"目标未能完全实现。我们对此深感遗憾，并计划在后续版本中投入资源解决此问题。**

项目成果不仅体现在软件本身，也体现在一套完整的开发文档上，包括需求分析的雏形、详细的系统设计（特别是安全架构）、清晰的版本迭代记录、用户使用指南 (`README.txt` 已更新以反映新的部署方式)和开发者部署说明。

**新增：6.1.1 系统满足用户需求的评估与局限性**

**满足程度评估：**
对照1.2节定义的项目目标和3.1节梳理的核心用户需求，Schomepage V2.5在很大程度上实现了既定目标：
*   **易用性**：通过类似Word的半图形化界面，系统确实降低了非专业用户的上手门槛。用户可以通过拖拽、点击等方式完成大部分编辑操作，如 `main.html` 中直观的元素添加和属性调整。
*   **功能性**：核心功能如用户注册登录（`auth.js`, `register.js`, `server.py` 相关API）、文章创建编辑保存（编辑器JS逻辑，`/api/articles` 等API）、素材管理（图片上传、预设背景图标库）、动态内容展示（动态隐藏模块JS逻辑、访客通道 `server.py` 路由处理）和访客管理（访客统计 `accrecord.csv`）均已实现并可用。
*   **安全性**：实现了基于自定义离散对数加密的前后端密码保护方案（`crypto.js`, `crypto_utils.py`, `server.py` 密码比对逻辑），并通过邮箱验证、会话管理等手段提升了账户安全，如 `系统安全性说明.md` 所述。
*   **可部署性**: ~~`setup.py` 脚本成功打包了Windows可执行程序，简化了本地部署流程。~~ **(更新：由于一键安装包的移除，当前版本的可部署性相较于最初目标有所下降，需要用户具备一定的手动操作能力。但核心功能依然可以通过手动方式部署和运行。) **

对于2.2节定义的目标用户：
*   **教育工作者**可以利用图文编辑、文章链接、动态隐藏和访客通道来创建和分享教学内容。
*   **学生和个人创作者**也能方便地制作个人主页和发布文章。

**潜在局限性与未完全满足的需求：**
尽管V2.5功能已相对完善，但也存在一些局限和待改进之处：
*   **数据存储的扩展性与并发性**：目前采用CSV文件存储（如 `users.csv`, 文章HTML文件）方案，虽然简单易部署，但在用户量和文章数量显著增多时，会面临性能瓶颈（如文件读写效率、数据查询分析的复杂性）。同时，CSV文件本质上不利于处理高并发读写请求，尽管当前系统主要面向单用户编辑，但未来若扩展协作功能则难以支持。
*   **原生JavaScript的维护成本**：随着编辑器功能的日益复杂（例如未来支持更丰富的元素、布局、交互），纯原生JavaScript代码库的维护难度和开发成本可能会显著增加，尤其是在缺乏严格模块化规范和自动化测试覆盖的情况下。
*   **编辑器高级功能缺失**：相较于成熟的商业或开源编辑器，当前版本在富文本编辑（如表格、复杂列表、数学公式等）、高级布局控制（如响应式设计辅助工具）、内容版本历史与恢复等方面尚有较大差距。
*   **安全性标准的进一步提升**：自定义的离散对数加密算法虽然实现了端到端加密的理念，但其安全性、密钥管理方案的健壮性、以及抗攻击能力可能未经过如公开算法那样广泛和严格的审查。对于敏感度更高的数据，依赖标准、经过充分验证的加密库和协议（如HTTPS、JWT）会是更稳妥的选择。
*   **跨平台部署的便捷性**：~~`setup.py` 目前主要针对Windows平台。若要覆盖macOS、Linux用户，需要额外的打包和测试工作。~~ **(更新：当前手动部署方式对具备Python环境的跨平台用户具有一定的通用性，但缺乏针对各平台的优化和便捷封装。) **
*   **用户体验细节优化空间**：例如，目前缺乏文章自动保存机制；部分交互（如错误提示、加载状态）可以进一步优化；素材库的分类、搜索功能有待增强。
*   **安装部署的便捷性受损**：**由于移除了 `setup.exe` 一键安装功能，当前版本的用户入门门槛有所提高，对不熟悉Python和命令行的用户不够友好，这是V2.5版本最主要的遗憾之一。**

这些局限性为项目未来的迭代指明了方向。

### 6.2 遇到的挑战与解决方案
*   **JavaScript架构**: 初期因缺乏统一配置和模块化管理，导致常量重复声明、函数依赖混乱。通过引入 `config.js` 统一管理全局配置，并对JS文件进行功能拆分和优化加载顺序，解决了此问题 (v2.1)。
*   **安全性设计**: 实现端到端加密需要对加密算法有深入理解，并确保前后端逻辑一致性。团队通过学习离散对数加密原理，并进行多次测试验证，最终实现了可靠的加密方案 (v2.0)。
*   **路由冲突**: 在实现无登录别名访问功能时，过于宽泛的Flask路由规则导致静态资源（JS, CSS）请求被错误拦截。通过在路由处理函数中增加对常见静态文件后缀的判断和排除逻辑，解决了此严重问题。
*   **用户体验细节**: 如撤销重做功能的完善、自定义对话框替换原生prompt、图片对齐的统一处理等，都是在不断测试和使用过程中逐步优化完善的。
*   **交付前期的重大技术障碍**：**在项目临近交付的最终调试阶段，原计划通过 `setup.py` 和 PyInstaller 打包的 `schomepage.exe` 一键安装程序被发现存在无法在短时间内解决的重大稳定性和潜在安全漏洞。这直接威胁到软件的可用性和用户数据安全。面对交付期限的压力，团队在评估后决定，优先保障核心编辑功能的稳定可用，暂时放弃一键安装包，改为提供手动部署和启动方案。这个决策虽然保证了核心功能的交付，但也牺牲了原计划的用户便利性，并要求团队迅速更新用户文档和使用说明。**

### 6.3 团队成员学习与收获
通过这个项目，团队成员不仅提升了各自在前后端开发、数据库设计、UI/UX设计方面的专业技能，更重要的是：
*   **软件工程实践**: 完整体验了从需求分析到部署维护的软件开发全过程，深刻理解了软件工程方法在实际项目中的应用。
*   **团队协作能力**: 学会了如何在团队中有效沟通、分工协作、解决冲突。
*   **问题解决能力**: 面对开发过程中遇到的各种技术难题和未知领域，培养了独立思考、查阅资料、动手实践解决问题的能力。
*   **文档编写能力**: 认识到良好文档对于项目开发、维护和知识传承的重要性。

### 6.4 未来发展方向
参照 `代码更新与修复说明.md` 中的未来计划，Schomepage系统仍有广阔的提升空间：
*   **短期计划**: 
    *   **首要任务：修复并完善安装部署机制**：投入精力彻底解决原 `setup.exe` 安装包的漏洞，或研究更稳定可靠的打包和分发方案（如MSIX, or alternative PyInstaller configurations），争取尽快恢复并改进一键安装体验。
    *   增强富文本编辑器功能（如表格、列表支持）、增加更多模板主题、实现批量图片处理、引入文章分类功能。
    *   **优化动态内容推送与分析**：增强访客统计功能，提供更直观的数据可视化界面，帮助用户更好地理解访客行为，从而优化动态隐藏规则的设置，特别是在校园等需要精细化运营的场景。
*   **中期计划**: 开发多用户协作编辑功能、集成评论系统、进行SEO优化、考虑开发移动端应用。
    *   **智能化内容推荐初步探索**：基于现有的动态隐藏框架和访客数据，尝试引入简单的规则引擎或协同过滤算法，为特定用户群体（如校园内的特定专业学生）提供初步的内容推荐服务。
*   **长期规划**: 构建插件系统和主题商店，实现云存储集成，开放API平台，打造更完善的生态。
    *   **深度个性化与智能推送**：结合更深入的访客行为分析（例如，不仅仅是访问次数，还包括页面停留时间、点击热图等），利用机器学习方法优化动态隐藏规则的自动推荐，或实现更智能化的内容个性化推送。例如，在校园主页场景，可以根据学生的专业、年级等更细致的标签，自动推送相关的课程推荐、实习机会或活动通知，并持续分析推送效果以优化算法。
*   **安全性增强**: 如引入HTTPS、升级加密算法参数、添加盐值、使用JWT令牌等，以适应更高安全要求的场景。

**新增：6.4.1 持续性建设建议**

为了确保Schomepage项目的健康发展和团队成员能力的持续提升，我们提出以下有效建议：

**一、 技术层面持续优化：**
1.  **数据存储方案升级**：研究并适时迁移到更健壮的数据存储方案，例如轻量级的关系型数据库（如SQLite，尤其适合本地应用）或文档数据库（如MongoDB Atlas的免费层，若考虑云端扩展）。这将显著改善数据管理效率、查询能力和未来支持并发操作的基础。
2.  **前端架构现代化**：当项目复杂度进一步提升时，考虑逐步引入或迁移到轻量级、高效的前端框架或库（如Vue.js, Svelte, 或Preact）。这有助于改善代码组织、组件化开发、状态管理和长期可维护性，同时也能提升开发效率。
3.  **强化自动化测试**：
    *   **单元测试**：为核心的后端逻辑（如 `server.py` 中的API处理器、`crypto_utils.py`）和前端关键模块（如 `crypto.js`、编辑器核心操作函数）编写更全面的单元测试用例，并追求较高的代码覆盖率。
    *   **集成测试**：扩展现有的集成测试场景，覆盖更多用户使用的核心路径，并考虑引入自动化测试框架（如Selenium用于UI测试，或Pytest结合requests进行API测试）。
4.  **构建CI/CD流程**：逐步建立持续集成/持续部署（CI/CD）流水线（例如使用GitHub Actions, Jenkins等）。实现代码提交后自动运行测试、自动打包（甚至自动部署到测试环境），能极大提高开发效率和软件质量。
5.  **提升安全性实践**：
    *   **HTTPS全面启用**：在部署时（即便是本地服务器也可生成自签名证书用于开发测试）强制使用HTTPS，确保传输层安全。
    *   **密码安全强化**：未来考虑使用业界标准的密码哈希算法（如Argon2, scrypt, bcrypt）替代或增强现有自定义加密，并引入加盐（Salt）和胡椒（Pepper）机制。对于会话管理，研究并采用基于Token的认证（如JWT）。
    *   **依赖安全扫描**：定期使用工具扫描项目依赖的第三方库，及时发现并修复已知的安全漏洞。

**二、 项目管理与协作优化：**
1.  **规范化敏捷实践**：可以尝试引入更具体的敏捷方法论，如Scrum（设定Sprint、每日站会、评审和回顾会议）或Kanban（可视化工作流、限制在制品数量），以提高团队协作效率和项目交付的规律性。
2.  **加强代码评审 (Code Review)**：将代码评审制度化，确保每一段重要代码在合并前都经过至少一名其他团队成员的审查。这有助于提早发现潜在问题、统一编码风格、促进知识共享。
3.  **完善与活用文档**：
    *   **开发者文档**：持续维护和更新API接口文档（可考虑使用Swagger/OpenAPI等工具）、系统架构图、模块设计说明等。
    *   **用户文档**：根据用户反馈和功能迭代，及时更新用户手册和FAQ。
    *   **决策记录**: 对于重要的技术选型、架构变更等，做好简要的决策记录（ADR - Architecture Decision Records），方便后续回顾和新成员理解。

**三、 团队学习与知识传承：**
1.  **定期技术分享与研讨**：团队内部定期举行技术分享会，成员轮流分享在项目中遇到的问题、解决方案、学习到的新技术或工具，共同进步。
2.  **鼓励探索与创新**：鼓励团队成员在完成核心任务之余，花时间研究和实验新技术、新工具，并思考如何将其应用于Schomepage的改进中。
3.  **参与外部交流**：关注相关技术社区的动态，鼓励参与技术论坛讨论，甚至向开源项目贡献代码，开阔视野。
4.  **知识库建设**：逐步建立团队内部的知识库（如使用Wiki系统），沉淀项目开发过程中的经验教训、最佳实践、常见问题解决方案等，方便知识传承。

通过上述措施的持续实践，Schomepage项目不仅能在功能和性能上不断完善，团队的整体工程能力和协作水平也将得到显著提升。

---

**我们坚信，Schomepage主页生成系统作为一个起点，为团队积累了宝贵的经验，并为未来的学习和更复杂的项目挑战打下了坚实的基础。** 